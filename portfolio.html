<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>목표 포트폴리오</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f5f7;
      --card: #ffffff;
      --border: #e2e2e8;
      --accent: #4b8cff;
      --accent-soft: #e0ebff;
      --text-main: #111827;
      --text-sub: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .container {
      width: 100%;
      max-width: 960px;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 4px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 16px;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }

    /* 요약 섹션 */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .summary-item {
      background: #f9fafb;
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .summary-label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    .summary-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-main);
    }

    /* 검색 및 정렬 */
    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 200px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
    }

    .search-box:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* 테이블 */
    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .portfolio-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .portfolio-table thead {
      background: #f9fafb;
    }

    .portfolio-table th,
    .portfolio-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #edf0f4;
      text-align: left;
      white-space: nowrap;
    }

    .portfolio-table th:nth-child(4),
    .portfolio-table td:nth-child(4) {
      text-align: right;
    }

    .portfolio-table thead th {
      font-weight: 600;
      font-size: 12px;
      color: #4b5563;
      border-bottom: 1px solid var(--border);
    }

    .sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
      padding-right: 20px !important;
    }

    .sortable:hover {
      background: #f3f4f6;
    }

    .sortable::after {
      content: '⇅';
      position: absolute;
      right: 6px;
      opacity: 0.3;
      font-size: 10px;
    }

    .sortable.asc::after {
      content: '↑';
      opacity: 1;
    }

    .sortable.desc::after {
      content: '↓';
      opacity: 1;
    }

    .badge-etf {
      display: inline-flex;
      align-items: center;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #bfdbfe;
      background: #eff6ff;
      color: #1d4ed8;
      font-weight: 500;
    }

    .badge-stock {
      display: inline-flex;
      align-items: center;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #374151;
      font-weight: 500;
    }

    .weight-cell {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }

    .ticker {
      font-family: "Menlo", "SF Mono", ui-monospace, monospace;
      font-size: 12px;
      letter-spacing: 0.02em;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 8px;
    }

    .section-caption {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 8px;
    }

    .etf-link {
      border: none;
      background: none;
      padding: 0;
      margin: 0;
      font: inherit;
      color: var(--accent);
      cursor: pointer;
      text-align: left;
    }

    .etf-link:hover {
      text-decoration: underline;
    }

    .etf-detail-row {
      display: none;
      background: #f9fafb;
    }

    .etf-detail-row td {
      border-bottom: 1px solid #edf0f4;
      padding-top: 4px;
      padding-bottom: 10px;
    }

    .etf-detail {
      font-size: 12px;
      color: var(--text-sub);
    }

    .etf-detail-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .etf-detail-name {
      font-weight: 600;
      color: var(--text-main);
    }

    .etf-detail-ticker {
      font-family: "Menlo", "SF Mono", ui-monospace, monospace;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #e5edff;
      color: #1e3a8a;
    }

    .etf-detail-desc {
      margin: 0 0 4px;
      line-height: 1.5;
    }

    .etf-detail-meta {
      margin: 4px 0 2px;
      font-size: 11px;
      color: var(--text-sub);
    }

    .etf-detail-holdings {
      margin: 0;
      padding-left: 16px;
      font-size: 11px;
    }

    .etf-detail-holdings li {
      margin-bottom: 2px;
    }

    .holding-link {
      border: none;
      background: none;
      padding: 0;
      margin: 0;
      font: inherit;
      cursor: pointer;
      color: #111827;
    }

    .holding-link:hover {
      text-decoration: underline;
    }

    .holding-info {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-sub);
    }

    .chart-wrapper {
      position: relative;
      max-width: 640px;
      margin: 0 auto;
    }

    #weightPieChart,
    #projectionChart {
      width: 100%;
      height: auto;
    }

    .scale-tabs {
      display: inline-flex;
      border-radius: 999px;
      background: #f3f4f6;
      padding: 2px;
      margin-bottom: 8px;
      gap: 4px;
    }

    .scale-tab {
      border: none;
      background: transparent;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      cursor: pointer;
      color: #6b7280;
    }

    .scale-tab.active {
      background: #2563eb;
      color: #ffffff;
      font-weight: 600;
    }

    @media (max-width: 640px) {
      body {
        padding: 12px;
      }
      .card {
        padding: 12px;
        border-radius: 12px;
      }
      .portfolio-table th,
      .portfolio-table td {
        padding: 6px 8px;
        font-size: 12px;
      }
      .summary-grid {
        grid-template-columns: 1fr;
      }
      .controls {
        flex-direction: column;
      }
      .search-box {
        width: 100%;
      }
      h1 {
        font-size: 20px;
      }
      .section-title {
        font-size: 14px;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <header style="margin-bottom: 14px;">
      <h1>목표 포트폴리오</h1>
      <p class="subtitle">종목 · 티커 · 자산 유형 · 목표 비중을 한눈에 보는 정리용 페이지</p>
    </header>

    <!-- 포트폴리오 요약 -->
    <section class="card">
      <h2 class="section-title">포트폴리오 요약</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">총 종목 수</div>
          <div class="summary-value" id="totalCount">-</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">ETF 비중</div>
          <div class="summary-value" id="etfWeight">-</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">개별주 비중</div>
          <div class="summary-value" id="stockWeight">-</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">총 비중</div>
          <div class="summary-value" id="totalWeight">-</div>
        </div>
      </div>
    </section>

    <!-- 목표 비중 원형 차트 -->
    <section class="card">
      <h2 class="section-title">목표 비중 원형 차트</h2>
      <p class="section-caption">
        아래 차트는 현재 포트폴리오의 각 종목 목표 비중을 기준으로 그린 원형 그래프입니다.
      </p>
      <div class="chart-wrapper">
        <canvas id="weightPieChart"></canvas>
      </div>
    </section>

    <!-- 메인 포트폴리오 표 -->
    <section class="card">
      <div class="controls">
        <input 
          type="text" 
          class="search-box" 
          id="searchInput" 
          placeholder="종목명 또는 티커로 검색..."
        />
      </div>
      <div class="table-wrapper">
        <table class="portfolio-table">
          <thead>
            <tr>
              <th class="sortable" data-sort="name">종목</th>
              <th class="sortable" data-sort="ticker">티커</th>
              <th>유형</th>
              <th class="sortable" data-sort="weight">목표 비중</th>
            </tr>
          </thead>
          <tbody id="portfolioTableBody">
          </tbody>
        </table>
      </div>
    </section>

    <!-- 장기 목표 시나리오 그래프 -->
    <section class="card">
      <h2 class="section-title">장기 목표 포트폴리오 시나리오 (예상)</h2>
      <p class="section-caption">
        2025년 말 약 4,000만 원에서 시작해 연 15% 수익률을 목표로 했을 때, 2060년까지의 대략적인 성장 시나리오입니다.
      </p>
      <p class="section-caption">
        ※ 가정: 2025년 말 4,000만 원에서 시작, 2026~2029년까지 아래와 같이 추가 투자 후 2030년 이후에는 추가 투자 없이 연 15% 복리만 적용.
        <br>· 2026년: 상반기 매 영업일 30만 원, 하반기 25만 원 → 연말 기준 약 6,900만 원
        <br>· 2027년: 상반기 매 영업일 20만 원, 하반기 15만 원 → 연말 기준 약 4,400만 원
        <br>· 2028년: 매 영업일 10만 원 → 연말 기준 약 2,500만 원
        <br>· 2029년: 매 영업일 10만 원 → 연말 기준 약 2,500만 원
      </p>
      <p class="section-caption">
        ※ 4년 동안 총 약 1억 5천만 원을 추가로 투자하는 셈이며, 아래 그래프는 <strong>참고용 시나리오</strong>입니다.
      </p>

      <div class="chart-wrapper">
        <div class="scale-tabs">
          <button type="button" class="scale-tab active" data-scale="linear">
            일반 스케일
          </button>
          <button type="button" class="scale-tab" data-scale="log">
            로그 스케일
          </button>
        </div>
        <canvas id="projectionChart"></canvas>
      </div>
    </section>
  </div>

<script>
  // 포트폴리오 데이터
  const portfolioData = [
    { name: "SPY / VOO (S&P 500)", ticker: "SPY / VOO", type: "etf", typeLabel: "ETF · 지수", weight: 36, etfKey: "SPY_VOO" },
    { name: "알파벳 A", ticker: "GOOGL", type: "stock", typeLabel: "개별주", weight: 5 },
    { name: "QQQ", ticker: "QQQ", type: "etf", typeLabel: "ETF · IT", weight: 5, etfKey: "QQQ" },
    { name: "GLD", ticker: "GLD", type: "etf", typeLabel: "ETF · 원자재", weight: 5, etfKey: "GLD" },
    { name: "JEPQ", ticker: "JEPQ", type: "etf", typeLabel: "ETF · 배당/옵션", weight: 4, etfKey: "JEPQ" },
    { name: "XAR", ticker: "XAR", type: "etf", typeLabel: "ETF · 항공/방산", weight: 4, etfKey: "XAR" },
    { name: "팔란티어", ticker: "PLTR", type: "stock", typeLabel: "개별주", weight: 3.5 },
    { name: "테슬라", ticker: "TSLA", type: "stock", typeLabel: "개별주", weight: 3.5 },
    { name: "ARKQ", ticker: "ARKQ", type: "etf", typeLabel: "ETF · 혁신/로봇", weight: 3, etfKey: "ARKQ" },
    { name: "QTUM", ticker: "QTUM", type: "etf", typeLabel: "ETF · 퀀텀/머신러닝", weight: 3, etfKey: "QTUM" },
    { name: "VWO", ticker: "VWO", type: "etf", typeLabel: "ETF · 신흥국", weight: 3, etfKey: "VWO" },
    { name: "GRID", ticker: "GRID", type: "etf", typeLabel: "ETF · 전력 인프라", weight: 2.5, etfKey: "GRID" },
    { name: "TAN", ticker: "TAN", type: "etf", typeLabel: "ETF · 태양광", weight: 2.5, etfKey: "TAN" },
    { name: "애플", ticker: "AAPL", type: "stock", typeLabel: "개별주", weight: 2 },
    { name: "엔비디아", ticker: "NVDA", type: "stock", typeLabel: "개별주", weight: 2 },
    { name: "마이크로소프트", ticker: "MSFT", type: "stock", typeLabel: "개별주", weight: 2 },
    { name: "아마존", ticker: "AMZN", type: "stock", typeLabel: "개별주", weight: 2 },
    { name: "일라이 릴리", ticker: "LLY", type: "stock", typeLabel: "개별주", weight: 2 },
    { name: "VEA", ticker: "VEA", type: "etf", typeLabel: "ETF · 선진국(미국 제외)", weight: 2, etfKey: "VEA" },
    { name: "메타", ticker: "META", type: "stock", typeLabel: "개별주", weight: 1.5 },
    { name: "아이온큐", ticker: "IONQ", type: "stock", typeLabel: "개별주", weight: 1.5 },
    { name: "코인베이스", ticker: "COIN", type: "stock", typeLabel: "개별주", weight: 1.5 },
    { name: "브로드컴", ticker: "AVGO", type: "stock", typeLabel: "개별주", weight: 1.5 },
    { name: "템퍼스 AI", ticker: "TEM", type: "stock", typeLabel: "개별주", weight: 1 },
    { name: "로켓랩", ticker: "RKLB", type: "stock", typeLabel: "개별주", weight: 1 }
  ];

  // ETF 상세 정보
  const etfDetails = {
    SPY_VOO: {
      fullName: "SPY / VOO",
      ticker: "SPY · VOO",
      description: "미국 대형주 500개로 구성된 S&P 500 지수를 추종하는 대표 지수 ETF들. 미국 주식 시장 전체의 성장을 넓게 가져가는 역할을 하는 코어 자산.",
      meta: "운용 보수는 대략 연 0.03~0.09% 수준(상품별 상이). 상위 보유 종목은 NVIDIA, Apple, Microsoft, Amazon, Alphabet 등이 대표적."
    },
    QQQ: {
      fullName: "Invesco QQQ",
      ticker: "QQQ",
      description: "나스닥 100 지수를 추종하는 성장주/기술주 중심 ETF. 금융을 제외한 미국 대형 기술·커뮤니케이션·소비주 비중이 매우 높음.",
      meta: "운용 보수는 대략 연 0.20% 수준. 상위 보유 종목은 NVIDIA, Apple, Microsoft, Amazon, Meta, Alphabet 등이 대부분을 차지."
    },
    GLD: {
      fullName: "SPDR Gold Shares",
      ticker: "GLD",
      description: "금 현물(골드 바)에 직접 투자하는 물리적 금 ETF. 금 가격을 수수료 차감 후 최대한 그대로 따라가는 것을 목표로 함.",
      meta: "운용 보수는 대략 연 0.40% 안팎. 기초자산은 런던 금괴시장 규격에 맞는 금 바 100%에 가까운 비중."
    },
    JEPQ: {
      fullName: "JPMorgan Nasdaq Equity Premium Income",
      ticker: "JEPQ",
      description: "나스닥 성장주에 투자하면서 콜옵션 전략을 활용해 프리미엄(분배금)을 노리는 ETF.",
      meta: "운용 보수는 대략 연 0.35~0.40%대."
    },
    XAR: {
      fullName: "SPDR S&P Aerospace & Defense ETF",
      ticker: "XAR",
      description: "항공·방위산업 섹터에 집중 투자하는 ETF.",
      meta: "운용 보수: 연 0.35% 수준. 상위 보유 종목 (예시, 비중은 2026-01 기준 대략):",
      holdings: [
        { symbol: "KARMAN", name: "Karman Holdings", weight: "약 4.6%" },
        { symbol: "KTOS", name: "Kratos Defense (KTOS)", weight: "약 4.5%" },
        { symbol: "RKLB", name: "Rocket Lab (RKLB)", weight: "약 4.4%" },
        { symbol: "AVAV", name: "AeroVironment (AVAV)", weight: "약 4.3%" },
        { symbol: "LMT", name: "Lockheed Martin (LMT)", weight: "약 3.4%" }
      ]
    },
    ARKQ: {
      fullName: "ARK Autonomous Tech & Robotics ETF",
      ticker: "ARKQ",
      description: "자율주행, 로봇, 드론, 우주, 산업 자동화 등 테마에 집중하는 액티브 ETF.",
      meta: "운용 보수: 연 0.75% 수준. 상위 보유 종목 (예시, 비중은 시점에 따라 변동):",
      holdings: [
        { symbol: "TSLA", name: "Tesla (TSLA)", weight: "약 10%" },
        { symbol: "KTOS", name: "Kratos Defense (KTOS)", weight: "약 10%" },
        { symbol: "TER", name: "Teradyne (TER)", weight: "약 9~10%" },
        { symbol: "RKLB", name: "Rocket Lab (RKLB)", weight: "약 6%" }
      ]
    },
    QTUM: {
      fullName: "Defiance Quantum ETF",
      ticker: "QTUM",
      description: "양자컴퓨팅 및 머신러닝 관련 기업에 투자하는 테마형 ETF.",
      meta: "운용 보수: 대략 연 0.40% 수준. 상위 보유 종목 (예시, 약 비중):",
      holdings: [
        { symbol: "QNC", name: "Quantum eMotion (QNC)", weight: "약 2%" },
        { symbol: "MU", name: "Micron Technology (MU)", weight: "약 1.6%" },
        { symbol: "LRCX", name: "Lam Research (LRCX)", weight: "약 1.5%" },
        { symbol: "ONTO", name: "Onto Innovation (ONTO)", weight: "약 1.5%" },
        { symbol: "KLAC", name: "KLA (KLAC)", weight: "약 1.5%" }
      ]
    },
    VWO: {
      fullName: "Vanguard FTSE Emerging Markets ETF",
      ticker: "VWO",
      description: "FTSE Emerging Markets 지수를 추종하는 대표 신흥국 주식 ETF.",
      meta: "운용 보수: 대략 연 0.07% 수준. 상위 보유 종목 (예시, 약 비중):",
      holdings: [
        { symbol: "TSMC", name: "TSMC (2330.TW / TSM)", weight: "약 11%" },
        { symbol: "TENCENT", name: "Tencent (0700.HK)", weight: "약 4~5%" },
        { symbol: "BABA", name: "Alibaba (9988.HK)", weight: "약 3%" },
        { symbol: "HDFCBANK", name: "HDFC Bank", weight: "약 1.1%" },
        { symbol: "RELIANCE", name: "Reliance Industries", weight: "약 1.1%" }
      ]
    },
    GRID: {
      fullName: "First Trust Nasdaq Clean Edge Smart Grid Infra",
      ticker: "GRID",
      description: "스마트 그리드·전력 인프라 관련 기업에 집중 투자하는 ETF.",
      meta: "운용 보수: 연 0.63% 수준. 상위 보유 종목 (예시, 약 비중):",
      holdings: [
        { symbol: "ABB", name: "ABB Ltd", weight: "약 8%" },
        { symbol: "NG", name: "National Grid", weight: "약 8%" },
        { symbol: "SCHNEIDER", name: "Schneider Electric", weight: "약 8%" },
        { symbol: "JCI", name: "Johnson Controls", weight: "약 7~8%" },
        { symbol: "ETN", name: "Eaton", weight: "약 7%" }
      ]
    },
    TAN: {
      fullName: "Invesco Solar ETF",
      ticker: "TAN",
      description: "전 세계 태양광 에너지 기업에 집중 투자하는 섹터 ETF.",
      meta: "운용 보수: 대략 연 0.70% 수준. 상위 보유 종목 (예시, 약 비중):",
      holdings: [
        { symbol: "FSLR", name: "First Solar (FSLR)", weight: "약 10%" },
        { symbol: "NXT", name: "Nextracker (NXT)", weight: "약 10%" },
        { symbol: "RUN", name: "Sunrun (RUN)", weight: "약 7%" },
        { symbol: "ENPH", name: "Enphase Energy (ENPH)", weight: "약 6%" }
      ]
    },
    VEA: {
      fullName: "Vanguard FTSE Developed Markets ETF",
      ticker: "VEA",
      description: "미국을 제외한 선진국 주식에 분산 투자하는 ETF.",
      meta: "운용 보수: 대략 연 0.03% 수준. 상위 보유 종목 (예시, 약 비중):",
      holdings: [
        { symbol: "ASML", name: "ASML", weight: "약 1.5%" },
        { symbol: "SAMSUNG", name: "Samsung Electronics", weight: "약 1.2%" },
        { symbol: "AZN", name: "AstraZeneca", weight: "약 1.0%" },
        { symbol: "ROCHE", name: "Roche", weight: "약 1.0% 내외" }
      ]
    }
  };

  // 보유 종목 설명
  const holdingDescriptions = {
    XAR: {
      KARMAN: "Karman Holdings: 항공우주 부품·서비스 업체로, 민간/군용 항공기와 우주 관련 부품을 공급.",
      KTOS: "Kratos Defense (KTOS): 무인기(UAV), 위성 통신, 방산 시스템을 만드는 미국 방위산업 회사.",
      RKLB: "Rocket Lab (RKLB): 소형 위성을 위한 로켓 발사 서비스와 위성 플랫폼을 제공하는 뉴질랜드/미국 우주 기업.",
      AVAV: "AeroVironment (AVAV): 소형 무인기·미사일 시스템을 만드는 방산 업체로, 정찰 드론에 강점.",
      LMT: "Lockheed Martin (LMT): F-35 전투기, 미사일, 우주 시스템 등 다양한 방산 장비를 생산하는 글로벌 1위급 방산 기업."
    },
    ARKQ: {
      TSLA: "Tesla (TSLA): 전기차, 에너지 저장, 자율주행 소프트웨어를 중심으로 하는 대표 성장주.",
      KTOS: "Kratos Defense: 저가·효율적인 무인기·방산 솔루션으로 ARK가 자주 담는 방산 성장주.",
      TER: "Teradyne (TER): 반도체·전자 테스트 장비를 만드는 회사로, 공장 자동화(로봇) 사업도 함께 영위.",
      RKLB: "Rocket Lab: 소형 위성 발사 및 우주 인프라 플랫폼 기업으로, ARKQ의 우주 테마 핵심 보유주 중 하나."
    },
    QTUM: {
      QNC: "Quantum eMotion (QNC): 양자 난수 생성 기술 등 보안용 양자기술을 연구·개발하는 캐나다 기업.",
      MU: "Micron (MU): 메모리 반도체(DRAM, NAND) 대형 제조사로, 데이터센터·AI·모바일 수요에 노출.",
      LRCX: "Lam Research (LRCX): 반도체 제조용 식각·증착 장비 분야 글로벌 선두 업체.",
      ONTO: "Onto Innovation (ONTO): 반도체 공정 검사·계측 장비 회사로, 웨이퍼 검사 솔루션에 강점.",
      KLAC: "KLA (KLAC): 반도체 공정 제어·검사 장비 글로벌 강자. 수율 관리와 공정 안정화에 필수 솔루션을 제공."
    },
    VWO: {
      TSMC: "TSMC: 세계 최대 파운드리(반도체 위탁생산) 업체. 고급 공정(3nm 등)에서 압도적인 점유율을 가짐.",
      TENCENT: "Tencent: 위챗, 게임, 핀테크, 클라우드 등 중국 디지털 생태계를 이끄는 빅테크 기업.",
      BABA: "Alibaba: 전자상거래(타오바오·티몰), 클라우드(알리바바 클라우드) 등을 가진 중국 빅테크.",
      HDFCBANK: "HDFC Bank: 인도 대형 민간 은행으로, 소매·기업 금융 모두에서 인도 성장에 레버리지.",
      RELIANCE: "Reliance Industries: 인도 대형 복합기업. 에너지·리테일·통신(Jio) 등 여러 성장 축을 보유."
    },
    GRID: {
      ABB: "ABB: 전력·자동화·로봇 등 산업 인프라 솔루션을 제공하는 스위스 기반 글로벌 기업.",
      NG: "National Grid: 영국·미국에서 송배전망을 운영하는 전력 유틸리티.",
      SCHNEIDER: "Schneider Electric: 전력 관리·자동화 솔루션 글로벌 리더. 빌딩·데이터센터·산업용 전력 관리에 강점.",
      JCI: "Johnson Controls: 빌딩 관리 시스템, HVAC, 스마트 빌딩 솔루션을 제공하는 미국 기업.",
      ETN: "Eaton: 전력 관리, 배전 장비, 산업용 부품을 생산하는 글로벌 전력 인프라 기업."
    },
    TAN: {
      FSLR: "First Solar (FSLR): 박막(Thin-film) 태양광 모듈을 만드는 미국 업체. 유틸리티급 발전소 중심.",
      NXT: "Nextracker (NXT): 태양광 패널을 태양 방향으로 움직여 효율을 높이는 트래커 시스템 전문 회사.",
      RUN: "Sunrun (RUN): 미국 주택용 태양광 설치 및 금융 솔루션 제공 업체.",
      ENPH: "Enphase Energy (ENPH): 태양광용 마이크로 인버터, 에너지 저장 시스템 등을 만드는 파워 일렉트로닉스 기업."
    },
    VEA: {
      ASML: "ASML: 극자외선(EUV) 노광 장비를 사실상 독점 공급하는 네덜란드 반도체 장비 회사.",
      SAMSUNG: "Samsung Electronics: 메모리·모바일·가전 등 다각화된 사업을 가진 한국 대표 IT 대형주.",
      AZN: "AstraZeneca: 영국-스웨덴계 글로벌 제약사. 항암·면역질환 등 혁신 신약 파이프라인을 보유.",
      ROCHE: "Roche: 스위스 제약·진단 기업으로, 항암제와 진단장비에서 세계적인 경쟁력을 보유."
    }
  };

  let currentSort = { column: null, direction: 'asc' };
  let filteredData = [...portfolioData];

  document.addEventListener("DOMContentLoaded", function () {
    updateSummary();
    renderPortfolioTable();
    renderPieChart();
    renderProjectionChart();
    setupEventListeners();
  });

  // 요약 정보 업데이트
  function updateSummary() {
    const total = portfolioData.length;
    const etfItems = portfolioData.filter(item => item.type === 'etf');
    const stockItems = portfolioData.filter(item => item.type === 'stock');
    
    const etfWeight = etfItems.reduce((sum, item) => sum + item.weight, 0);
    const stockWeight = stockItems.reduce((sum, item) => sum + item.weight, 0);
    const totalWeight = etfWeight + stockWeight;

    document.getElementById('totalCount').textContent = total + '개';
    document.getElementById('etfWeight').textContent = etfWeight.toFixed(1) + '%';
    document.getElementById('stockWeight').textContent = stockWeight.toFixed(1) + '%';
    document.getElementById('totalWeight').textContent = totalWeight.toFixed(1) + '%';
  }

  // 포트폴리오 테이블 렌더링
  function renderPortfolioTable() {
    const tbody = document.getElementById('portfolioTableBody');
    tbody.innerHTML = '';

    filteredData.forEach((item) => {
      const tr = document.createElement('tr');
      if (item.etfKey) {
        tr.className = 'etf-row';
        tr.dataset.etf = item.etfKey;
      }

      const nameCell = document.createElement('td');
      if (item.etfKey) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'etf-link';
        btn.textContent = item.name;
        nameCell.appendChild(btn);
      } else {
        nameCell.textContent = item.name;
      }

      const tickerCell = document.createElement('td');
      tickerCell.className = 'ticker';
      tickerCell.textContent = item.ticker;

      const typeCell = document.createElement('td');
      const badge = document.createElement('span');
      badge.className = item.type === 'etf' ? 'badge-etf' : 'badge-stock';
      badge.textContent = item.typeLabel;
      typeCell.appendChild(badge);

      const weightCell = document.createElement('td');
      weightCell.className = 'weight-cell';
      weightCell.textContent = item.weight + '%';

      tr.appendChild(nameCell);
      tr.appendChild(tickerCell);
      tr.appendChild(typeCell);
      tr.appendChild(weightCell);
      tbody.appendChild(tr);

      // ETF 상세 행
      if (item.etfKey && etfDetails[item.etfKey]) {
        const detailTr = document.createElement('tr');
        detailTr.className = 'etf-detail-row';
        detailTr.dataset.etfDetail = item.etfKey;
        detailTr.style.display = 'none';

        const detailTd = document.createElement('td');
        detailTd.colSpan = 4;

        const detail = etfDetails[item.etfKey];
        let detailHTML = `
          <div class="etf-detail">
            <div class="etf-detail-header">
              <span class="etf-detail-name">${detail.fullName}</span>
              <span class="etf-detail-ticker">${detail.ticker}</span>
            </div>
            <p class="etf-detail-desc">${detail.description}</p>
            <p class="etf-detail-meta">${detail.meta}</p>
        `;

        if (detail.holdings && detail.holdings.length > 0) {
          detailHTML += '<ul class="etf-detail-holdings" data-etf="' + item.etfKey + '">';
          detail.holdings.forEach(h => {
            detailHTML += `<li><button type="button" class="holding-link" data-etf="${item.etfKey}" data-symbol="${h.symbol}">${h.name} — ${h.weight}</button></li>`;
          });
          detailHTML += '</ul>';
          detailHTML += '<div class="holding-info" data-etf="' + item.etfKey + '"></div>';
        }

        detailHTML += '</div>';
        detailTd.innerHTML = detailHTML;
        detailTr.appendChild(detailTd);
        tbody.appendChild(detailTr);
      }
    });

    // ETF 토글 이벤트
    document.querySelectorAll('.etf-row .etf-link').forEach(btn => {
      btn.addEventListener('click', function() {
        const row = btn.closest('.etf-row');
        const key = row.dataset.etf;
        const detailRow = document.querySelector('.etf-detail-row[data-etf-detail="' + key + '"]');
        if (!detailRow) return;

        const isVisible = detailRow.style.display === 'table-row';
        document.querySelectorAll('.etf-detail-row').forEach(r => r.style.display = 'none');
        detailRow.style.display = isVisible ? 'none' : 'table-row';
      });
    });

    // 보유 종목 설명 토글
    document.querySelectorAll('.holding-link').forEach(link => {
      link.addEventListener('click', function() {
        const etf = this.dataset.etf;
        const symbol = this.dataset.symbol;
        const infoBox = document.querySelector('.holding-info[data-etf="' + etf + '"]');
        if (!infoBox) return;

        const byEtf = holdingDescriptions[etf] || {};
        const desc = byEtf[symbol];

        if (desc) {
          infoBox.textContent = desc;
        } else {
          infoBox.textContent = this.textContent.replace(/\s+—.+$/, '') + " : 상세 설명은 아직 정리되지 않았습니다.";
        }
      });
    });
  }

  // 이벤트 리스너 설정
  function setupEventListeners() {
    // 검색
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', function(e) {
      const query = e.target.value.toLowerCase();
      filteredData = portfolioData.filter(item => 
        item.name.toLowerCase().includes(query) || 
        item.ticker.toLowerCase().includes(query)
      );
      renderPortfolioTable();
    });

    // 정렬
    document.querySelectorAll('.sortable').forEach(th => {
      th.addEventListener('click', function() {
        const column = this.dataset.sort;
        
        if (currentSort.column === column) {
          currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.column = column;
          currentSort.direction = 'asc';
        }

        sortData(column, currentSort.direction);
        updateSortIndicators();
        renderPortfolioTable();
      });
    });
  }

  // 데이터 정렬
  function sortData(column, direction) {
    filteredData.sort((a, b) => {
      let valA, valB;

      if (column === 'name') {
        valA = a.name.toLowerCase();
        valB = b.name.toLowerCase();
      } else if (column === 'ticker') {
        valA = a.ticker.toLowerCase();
        valB = b.ticker.toLowerCase();
      } else if (column === 'weight') {
        valA = a.weight;
        valB = b.weight;
      }

      if (valA < valB) return direction === 'asc' ? -1 : 1;
      if (valA > valB) return direction === 'asc' ? 1 : -1;
      return 0;
    });
  }

  // 정렬 인디케이터 업데이트
  function updateSortIndicators() {
    document.querySelectorAll('.sortable').forEach(th => {
      th.classList.remove('asc', 'desc');
      if (th.dataset.sort === currentSort.column) {
        th.classList.add(currentSort.direction);
      }
    });
  }

  // 파이 차트
  function renderPieChart() {
    const labels = portfolioData.map(item => item.name);
    const data = portfolioData.map(item => item.weight);

    const ctxPie = document.getElementById("weightPieChart").getContext("2d");
    new Chart(ctxPie, {
      type: "pie",
      data: {
        labels,
        datasets: [{ data }]
      },
      options: {
        plugins: {
          legend: {
            position: "right",
            labels: { boxWidth: 12, font: { size: 11 } }
          }
        }
      }
    });
  }

  // 시나리오 차트
  function renderProjectionChart() {
    const years = [];
    const proj15 = [];
    const proj12 = [];
    const proj18 = [];

    let cur15 = 40000000;
    let cur12 = 40000000;
    let cur18 = 40000000;

    const startYear = 2025;
    const endYear = 2060;
    const rateBase = 0.15;
    const rateLow = 0.12;
    const rateHigh = 0.18;

    const yearlyContributions = {
      2026: 69000000,
      2027: 44000000,
      2028: 25000000,
      2029: 25000000
    };

    for (let y = startYear; y <= endYear; y++) {
      if (y === startYear) {
        years.push(y);
        proj15.push(cur15);
        proj12.push(cur12);
        proj18.push(cur18);
        continue;
      }

      const add = yearlyContributions[y] || 0;
      cur15 = cur15 * (1 + rateBase) + add;
      cur12 = cur12 * (1 + rateLow) + add;
      cur18 = cur18 * (1 + rateHigh) + add;

      years.push(y);
      proj15.push(Math.round(cur15));
      proj12.push(Math.round(cur12));
      proj18.push(Math.round(cur18));
    }

    const ctx2 = document.getElementById("projectionChart").getContext("2d");

    const allValues = proj15.concat(proj12, proj18);
    const maxValue = Math.max(...allValues);
    const minValue = Math.min(...allValues);
    const linearMin = 0;
    const linearMax = maxValue * 1.1;
    const logMin = Math.max(1e6, minValue * 0.5);
    const logMax = maxValue * 1.5;

    const linearTickCallback = (value) => {
      const billion = value / 100000000;
      if (billion < 0.1) return "";
      return billion.toLocaleString("ko-KR", { maximumFractionDigits: 1 }) + "억";
    };

    const logTickCallback = (value) => {
      const billion = value / 100000000;
      if (billion < 0.1) return "";
      return billion.toLocaleString("ko-KR", { maximumFractionDigits: 1 }) + "억";
    };

    const linearTickFont = (ctx) => {
      if (!ctx || !ctx.tick) return {};
      const val = ctx.tick.value;
      const target = 10000000000;
      if (Math.abs(val - target) / target < 0.15) {
        return { weight: "bold" };
      }
      return {};
    };

    const logTickFont = (ctx) => {
      if (!ctx || !ctx.tick) return {};
      const val = ctx.tick.value;
      const target = 10000000000;
      if (Math.abs(val - target) / target < 0.2) {
        return { weight: "bold" };
      }
      return {};
    };

    const scenarioChart = new Chart(ctx2, {
      type: "line",
      data: {
        labels: years,
        datasets: [
          {
            label: "기준 시나리오 (15%)",
            data: proj15,
            borderWidth: 3,
            pointRadius: 0,
            tension: 0.25,
            borderDash: [6, 4],
            borderColor: "#2563eb"
          },
          {
            label: "보수적 시나리오 (12%)",
            data: proj12,
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.25,
            borderDash: [4, 4],
            borderColor: "rgba(107,114,128,0.9)"
          },
          {
            label: "공격적 시나리오 (18%)",
            data: proj18,
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.25,
            borderDash: [4, 4],
            borderColor: "rgba(156,163,175,0.9)"
          }
        ]
      },
      options: {
        interaction: {
          mode: "index",
          intersect: false
        },
        plugins: {
          legend: {
            display: true,
            position: "bottom",
            labels: {
              usePointStyle: true,
              padding: 16
            }
          },
          tooltip: {
            callbacks: {
              label: (ctx) => {
                const v = ctx.parsed.y;
                const billion = v / 100000000;
                return `${ctx.dataset.label}: 약 ${billion.toLocaleString("ko-KR", { maximumFractionDigits: 1 })}억 원`;
              }
            }
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: "연도"
            },
            ticks: {
              font: (ctx) => {
                if (!ctx || !ctx.tick) return {};
                const yr = String(ctx.tick.value ?? ctx.tick.label);
                if (yr === "2025" || yr === "2055") {
                  return { weight: "bold" };
                }
                return {};
              }
            }
          },
          y: {
            type: "linear",
            min: linearMin,
            max: linearMax,
            title: {
              display: true,
              text: "예상 포트폴리오 가치 (억 원 기준)"
            },
            ticks: {
              callback: linearTickCallback,
              font: linearTickFont
            }
          }
        }
      }
    });

    function applyScaleMode(mode) {
      const yScale = scenarioChart.options.scales.y;

      if (mode === "linear") {
        yScale.type = "linear";
        yScale.min = linearMin;
        yScale.max = linearMax;
        yScale.title.text = "예상 포트폴리오 가치 (억 원 기준)";
        yScale.ticks.callback = linearTickCallback;
        yScale.ticks.font = linearTickFont;
      } else {
        yScale.type = "logarithmic";
        yScale.min = logMin;
        yScale.max = logMax;
        yScale.title.text = "예상 포트폴리오 가치 (억 원 기준, 로그 스케일)";
        yScale.ticks.callback = logTickCallback;
        yScale.ticks.font = logTickFont;
      }

      scenarioChart.update();
    }

    applyScaleMode("linear");

    document.querySelectorAll(".scale-tab").forEach((btn) => {
      btn.addEventListener("click", function () {
        const mode = this.dataset.scale;
        document.querySelectorAll(".scale-tab").forEach((b) => b.classList.remove("active"));
        this.classList.add("active");
        applyScaleMode(mode);
      });
    });
  }
</script>
</body>
</html>
